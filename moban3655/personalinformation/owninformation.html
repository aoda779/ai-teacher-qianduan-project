<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>个人管理</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,700">
    <!-- https://fonts.google.com/specimen/Roboto -->
    <link rel="stylesheet" href="../css/fontawesome.min.css">
    <!-- https://fontawesome.com/ -->
    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <!-- https://getbootstrap.com/ -->
    <link rel="stylesheet" href="../css/templatemo-style.css">
    <link rel="stylesheet" href="../iconfont/iconfont.css">
    <link rel="stylesheet" href="../iconfont2/iconfont.css">
    <link rel="stylesheet" href="../css/scoringpaper.css">
    <!--
	Product Admin CSS Template
	https://templatemo.com/tm-524-product-admin
	-->
</head>

<body id="reportsPage">
<div class="" id="home">
    <nav class="navbar navbar-expand-xl">
        <div class="container h-100">
            <a class="navbar-brand" href="#">
                <h1 class="tm-site-title mb-0">智阅专辅</h1>
            </a>
            <button class="navbar-toggler ml-auto mr-0" type="button" data-toggle="collapse"
                    data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                    aria-label="Toggle navigation">
                <i class="fas fa-bars tm-nav-icon"></i>
            </button>

            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav mx-auto h-100">
                    <li class="nav-item">
                        <a class="nav-link" href="../index.html">
                            <i class="fas iconfont icon-biaoshilei_yonghuzu
                          "></i> 考生管理
                            <span class="sr-only">(current)</span>
                        </a>
                    </li>

                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="../papersubmit.html" id="navbarDropdown" role="button"
                           data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <i class="far iconfont icon-jiqiren"></i>
                            <span>
                                智慧阅卷 <i class="fas fa-angle-down"></i>
                            </span>
                        </a>
                        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <a class="dropdown-item" href="../smartscoring/papersubmit.html">试卷上传</a>
                            <a class="dropdown-item" href="../smartscoring/rules.html">批阅规则</a>
                            <a class="dropdown-item" href="../smartscoring/papercheck.html">阅卷复核</a>
                            <a class="dropdown-item" href="../smartscoring/papermanage.html">试卷管理</a>

                        </div>
                    </li>

                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                           data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <i class="fas iconfont icon-shuji
                          "></i>
                            <span>
                              教师阅卷 <i class="fas fa-angle-down"></i>
                          </span>
                        </a>
                        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <a class="dropdown-item" href="../teacherscoring/paperread.html">阅卷</a>

                            <a class="dropdown-item" href="#">阅卷结果</a>

                        </div>
                    </li>

                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                           data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <i class="fas iconfont icon-anquan
                          "></i>
                            <span>
                              数据报告 <i class="fas fa-angle-down"></i>
                          </span>
                        </a>
                        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <a class="dropdown-item" href="../scoringpaper/studentreport.html">学生报告</a>
                            <a class="dropdown-item" href="../scoringpaper/classreport.html">班级报告</a>
                            <a class="dropdown-item" href="../scoringpaper/gradescoring.html">科目报告</a>

                        </div>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                           data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <i class="fas iconfont icon-yonghu
                            "></i>
                            <span>
                                个人信息 <i class="fas fa-angle-down"></i>
                            </span>
                        </a>
                        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <a class="dropdown-item" href="owninformation.html">个人信息</a>
                            <a class="dropdown-item" href="../personalinformation/classinformation.html">班级管理</a>

                        </div>
                    </li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link d-block" href="../login.html">
                            <b>退出登录</b>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- 下面是四个按钮 -->
    <div class="button4-container" style="margin-left: 560px;">
        <button class="button4" onclick="navigateTo('owninformation.html')">个人信息</button>
        <button class="button4" onclick="navigateTo('classinformation.html')">班级管理</button>

    </div>
    <div class="container">

        <div class="studentmanagement" style="display: flex;flex-direction: column;">
            <div style="display: flex;flex-direction: row;">
                <div style="
                    margin-top: 30px;
                    margin-left: 40px;
                    width: 130px;
                    height: 130px;
                    opacity: 1;
                    background: rgba(255, 255, 255, 1);">
                    <img src="../img/820f054b59e755fdea75c98f2c514a89.jpeg" width="130" height="130">
                </div>
                <div style="font-size: 38px;margin-top: 39px;margin-left: 10px;">
                    <div><label>姓名:</label><label id="name"></label></div>
                    <div><label>账号:</label><label id="account"></label></div>
                </div>
            </div>

            <div class="title3" style="margin-left: 400px;margin-top: 20px;">
                个人资料
            </div>
            <div style="display: flex;flex-direction: row; margin-left: 40px;margin-top: 40px;">
                <div class="text5">
                    姓名
                </div>
                <input class="text6" id="userName" name="userName" type="text" placeholder="姓名"/>
            </div>
            <div style="display: flex;flex-direction: row; margin-left: 40px;">
                <div class="text5">
                    学校
                </div>
                <input class="text6" id="schoolName" name="schoolName" type="text" disabled placeholder="学校"/>
            </div>
            <div style="display: flex;flex-direction: row; margin-left: 40px;">
                <div class="text5">
                    年级
                </div>
                <input class="text6" id="grade" name="grade" disabled type="text" placeholder="年级"/>
            </div>
            <div style="display: flex;flex-direction: row; margin-left: 40px;">
                <div class="text5">
                    负责班级
                </div>
                <select class="text6" id="clazzId" style="margin-left : 0px;">
                    <option value="">请选择</option>
                </select>
            </div>
            <div style="display: flex;flex-direction: row; margin-left: 40px;">
                <div class="text5">
                    电子邮箱
                </div>
                <input class="text6" id="email" name="email" type="text" placeholder="电子邮箱"/>
            </div>
            <div style="display: flex;flex-direction: row; margin-left: 40px;">
                <div class="text5">
                    手机电话
                </div>
                <input class="text6" id="phone" name="phone" type="text" placeholder="手机电话"/>
            </div>

            <div style="display: flex;flex-direction: row; margin-left: 40px;">
                <div class="text5" style="height: 200px;">
                    教学方法
                </div>
                <textarea class="text6" id="method" name="method" style="height: 200px;"></textarea>

            </div>

            <div>
                <button class="button4" id="saveInfo" style="margin-left: 396px; margin-top: 25px;font-size: 30px;">
                    保存
                </button>
            </div>
        </div>


    </div>

    <script>
        function setActive(button) {
            // 移除所有按钮的 'active' 类
            document.querySelectorAll('.button4').forEach(btn => btn.classList.remove('active4'));
            // 给点击的按钮添加 'active' 类
            button.classList.add('active4');
        }
    </script>
    <script>
        // 这里是类选择器
        document.querySelectorAll('.toggleButton').forEach(button => {
            button.addEventListener('click', function () {
                this.classList.toggle('clicked');
            });
        });
    </script>

    <script>
        function navigateTo(url) {
            window.location.href = url;
        }
    </script>
    <script src="../js/jquery-3.3.1.min.js"></script>
    <!-- https://jquery.com/download/ -->
    <script src="../js/moment.min.js"></script>
    <!-- https://momentjs.com/ -->
    <script src="../js/Chart.min.js"></script>
    <!-- http://www.chartjs.org/docs/latest/ -->
    <script src="../js/bootstrap.min.js"></script>
    <!-- https://getbootstrap.com/ -->
    <script src="../js/tooplate-scripts.js"></script>
    <script>
        Chart.defaults.global.defaultFontColor = 'white';
        let ctxLine,
            ctxBar,
            ctxPie,
            optionsLine,
            optionsBar,
            optionsPie,
            configLine,
            configBar,
            configPie,
            lineChart,
        barChart, pieChart;
        // DOM is ready
        $(function () {
            drawLineChart(); // Line Chart
            drawBarChart(); // Bar Chart
            drawPieChart(); // Pie Chart

            $(window).resize(function () {
                updateLineChart();
                updateBarChart();
            });
        })
    </script>
    <script type="text/javascript">
        //检查token状况
        let token = localStorage.getItem('token');
        if (token === null || token === 'undefined'){
            navigateTo("../login.html");
        }
        let userInfo=localStorage.getItem(token);
        if (userInfo === null || userInfo === 'undefined'){
            navigateTo("../login.html");
        }
        userInfo=JSON.parse(userInfo);
        let clazzInfo=[{}];
        function loadForm(){
            $.ajax({
                url: 'http://localhost:8080/user-info/get/detail',
                type: 'GET',
                headers: {
                    token: token
                },
                success: function (result) {
                    console.log(result);
                    if (result.code !== 200){
                        navigateTo('../login.html')
                    }
                    // 给表单字段赋值（将填写的数据进行保存）
                    $('#userName').val(result.data.userName);
                    $('#schoolName').val(result.data.schoolName);
                    $('#grade').val(result.data.grade);
                    $('#email').val(result.data.email);
                    $('#phone').val(result.data.phone);
                    $('#method').val(result.data.method);
                    $('#name').text(result.data.userName);
                    $('#account').text(result.data.account);
                    userInfo.id=result.data.id;
                },
                error: function (err) {
                    console.error('请求失败:', err);
                    navigateTo('../login.html')
                }
            })
        }
        $(document).ready(function (){
            loadForm();
            $.ajax({
                url: 'http://localhost:8080/clazz-info/get/list',
                type: 'GET',
                headers: {
                    token: token
                },
                success: function (result) {
                    console.log(result);
                    if (result.code == 200) {
                        console.log('查询成功');
                        let data = result.data;
                        if (data) {
                            clazzInfo=data;
                            for (let i = 0; i < data.length; i++) {
                                $('#clazzId').append($('<option>', {
                                    value: data[i].id,
                                    text: data[i].clazzName,
                                    selected: data[i].id == userInfo.clazzId
                                }))
                            }
                        }
                    }
                },
                error: function (err) {
                    console.error('请求失败:', err);
                    layer.msg('请求失败');
                }
            })

            //当年级开始变化的时候，学校和年纪会发生变化
            $('#clazzId').change(function (){
                let clazzId = $('#clazzId').val();
                for (let i = 0; i < clazzInfo.length; i++) {
                    if (clazzInfo[i].id == clazzId) {
                        $('#schoolName').val(clazzInfo[i].schoolName);
                        $('#grade').val(clazzInfo[i].grade);
                    }
                }
            })

            $('#saveInfo').click(function (){
                let data = {
                    id: userInfo.id,
                    userName: $('#userName').val(),
                    clazzId: $('#clazzId').val(),
                    email: $('#email').val(),
                    phone: $('#phone').val(),
                    method: $('#method').val()
                };
                $.ajax({
                    url: 'http://localhost:8080/user-info/modified/detail',
                    type: 'POST',
                    data: JSON.stringify(data),
                    contentType: 'application/json',
                    headers: {
                        token: token
                    },
                    success: function (result) {
                        console.log(result);
                        if (result.code == 200){
                            localStorage.setItem(token, JSON.stringify(data));
                            loadForm();
                        }
                    },
                    error: function (err) {
                    console.error('请求失败:', err);
                    alert('请求失败');
                }
                })
            })
        });
    </script>
</body>

</html>
